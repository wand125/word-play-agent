# 統合版 回文作成ガイド

## 1. 基本知識

### 回文とは
前から読んでも後ろから読んでも同じになる文字列。日本語では「逆さ言葉」とも呼ばれる。

### 回文の構造
- **中心対称型**：奇数文字数（例：たけやぶやけた）
- **軸対称型**：偶数文字数（例：しんぶんし）

### 日本語特有の考慮事項
- 濁音・半濁音：厳密型では区別、寛容型では同一視
- 拗音・促音：1文字として扱う
- 長音：扱いを事前に決定

## 2. 作成方法論

### 必須の検証プロセス
```python
# 回文性チェック
def is_palindrome(text):
    chars = list(text)
    return chars == chars[::-1]
```

### 段階的アプローチ
1. **2-3文字**：基礎練習（例：もも、あさあ）
2. **4-6文字**：単語レベル（例：しんぶんし）
3. **7-10文字**：短文レベル
4. **10文字以上**：長文への挑戦

### 作成テクニック

#### 1. 両端構築法
```
手順：始まりと終わりを同じにして中間を埋める
例：「わたし...したわ」→「わたしまけましたわ」
```

#### 2. 中心拡張法
```
手順：短い回文から両端に拡張
例：「うたう」→「くうたうく」→「よくうたうくよ」
```

#### 3. 中央挿入法（新）
```
手順：既存回文を分割し、中央に文字を挿入
例：「よきこ」+「と」+「こきよ」= 「よきことこきよ」
```

## 3. LLMによる作成時の注意点

### 重要な失敗例と教訓
1. **回文の誤認識**
   - 誤：「ああなつよなつああ」を回文と判定
   - 教訓：必ず文字単位で検証

2. **不自然な日本語**
   - 誤：「ひもなつあつなもひ」（日も夏暑な、も日）
   - 教訓：各段階で自然さを確認

3. **無理な文字の詰め込み**
   - 誤：「みずのみのみず」のような不自然な繰り返し
   - 教訓：意味を優先

### 品質評価基準
1. **回文性**（必須）：完全一致
2. **自然さ**（最重要）：日本語として違和感なし
3. **意味**：明確で理解可能
4. **音韻**：読みやすく美しい
5. **創造性**：新規性と記憶性

### ビームサーチ戦略
- ビーム幅：5-20候補を並行管理
- 評価：各段階で自然さを重視
- 枝刈り：不自然な候補は即除外

## 4. 実践的な拡張戦略

### 文字数調整のパターン
- **奇数→偶数**：中央に1文字追加
- **偶数→奇数**：両端に0.5文字相当を追加（困難）
- **微調整**：助詞の追加・削除で対応

### 10文字回文の構造例
1. 5-5型：ABCDE-EDCBA
2. 4-2-4型：ABCD-EE-DCBA
3. 3-4-3型：ABC-DEED-CBA
4. 2-6-2型：AB-CDEFED-BA

## 5. 実装ツール

### 検証スクリプト
```bash
python src/check_palindrome.py "候補文字列"
```

### 評価プロンプト
`docs/evaluation-prompts.md`を参照

## 6. 継続的改善

### 記録すべき内容
- すべての試行（成功・失敗）
- 却下理由の詳細分析
- 成功パターンの特徴
- 改善のヒント

### 学習サイクル
1. 試行 → 2. 記録 → 3. 分析 → 4. 改善 → 5. 文書化

---

*最終更新：2025年6月15日*
*このガイドは実践結果に基づいて継続的に更新されます*