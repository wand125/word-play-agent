# 回文作成エージェント専用ガイド

## 最重要命令

### 汎用的指示の自動反映
**汎用的な指示と判断したものは、自動的にCLAUDE.mdを更新する。**

- ユーザーの指示が汎用的・恒久的なルールの場合、即座にCLAUDE.mdに追加
- メタレベルの改善指示は最優先で反映
- 判断に迷った場合も、積極的に追加して後で調整

### 恒久的改善指示のチェックと階層管理
**ユーザーの文章は、まず恒久的な改善指示かチェックし、適切な階層のCLAUDE.mdに反映する。**

- すべてのユーザー入力を恒久性の観点で評価
- プロジェクト全体：`/palindromes-maker/CLAUDE.md`に反映
- 特定のtry：`/outputs/tryXX/CLAUDE.md`に反映
- 反映後は実行を継続

## 重要な原則

### CLAUDE.mdの継続的更新
**このCLAUDE.mdは生きた文書として、常にアップデートする。**

- 新しい運用ルールは即座に反映
- 学習事項を継続的に追加
- プロジェクトの成長とともに進化

### ドキュメントの差分管理と整理
**似たようなドキュメントは適切に統合し、最新情報のみを保持する。**

- 重複内容を発見したら自律的に統合
- 古い情報はold-docsへ移動
- 統合版には更新日時を明記
- 定期的に全ドキュメントの整合性を確認

### ドキュメントの品質維持
**ドキュメントを常に綺麗で読みやすい状態に保つ。**

- 一貫した書式とスタイルを維持
- 明確な見出しと構造化
- 不要な情報は削除
- 定期的な整理整頓を実施

### 方法論の分離管理
**プロジェクト改善の方法論と回文作成の方法論を明確に分離する。**

- 回文作成技術：`docs/`配下で管理
- プロジェクト運営：`META-INSTRUCTIONS.md`と各tryの`lessons-learned.md`で管理
- 知見は適切なカテゴリーで文書化
- 混在を避けて検索性を向上

### フィードバックへの対応
**指摘があれば、常に即座に反映し、改善する。** これは本プロジェクトの最重要原則です。

- ユーザーからの指摘は最優先で対応
- 誤りを認識したら即座に修正
- 改善内容は文書化して蓄積

### メソッドの厳守
**回文作成時は必ずドキュメント化されたメソッドに従う。** 直接作成は厳禁。

- 必ず作成ガイドラインに沿って実施
- 各ステップを記録しながら進行
- 検証プロセスを省略しない

### メタ命令の処理
**メタ命令を受けた場合は、プロジェクトのCLAUDE.mdに追加する。**

- ユーザーからのメタレベルの指示を認識
- CLAUDE.mdに適切に反映
- META-INSTRUCTIONS.mdも必要に応じて更新

### 戦略変更時の手順
**作戦を変える場合は、新しいtryフォルダを作成する。**

- outputs/tryXX/として新規作成
- 各tryには必ずCLAUDE.md、process.md、result.mdを含める
- 前のtryからの学習事項を引き継ぐ

### tryのプロセス管理
**tryのプロセスもドキュメントで管理する。**

- 各tryフォルダに必須ドキュメント：
  - `CLAUDE.md`：そのtryの方針と戦略
  - `process.md`：作成過程の詳細記録
  - `evaluate.md`：作成物の評価
  - `result.md`：最終結果のまとめ
  - `lessons-learned.md`：得られた知見

### 評価プロセス
**評価は各tryにevaluate.mdを作成して行う。**

- 各tryフォルダ内に`evaluate.md`を作成
- 作成した回文の詳細評価を記録
- 評価基準に基づいたスコアリング
- 改善点の具体的な指摘

### 回文作成時の思考プロセス
回文を作成する際は、**ultrathink（深い思考）**を使用して、以下のプロセスを必ず踏む：

1. **検証の徹底**
   - 回文性の文字単位での確認
   - 日本語の自然さの評価
   - 意味の明確性の確認

2. **段階的アプローチ**
   - 小さく始める
   - 各段階で検証
   - 自然さを保ちながら拡張

3. **記録と学習**
   - すべての試行を記録
   - 失敗から学ぶ
   - 成功パターンを蓄積

## プロジェクト構造

```
palindromes-maker/     # ★すべての作業はこのディレクトリ内で行う
├── CLAUDE.md          # このファイル
├── META-INSTRUCTIONS.md # メタレベルの指示
├── README.md          # プロジェクト概要
├── docs/              # ドキュメント
│   ├── README.md      # ドキュメント構成説明
│   ├── palindrome-creation-guide.md
│   ├── expansion-strategies.md
│   ├── evaluation-prompts.md
│   ├── llm-palindrome-creation-methodology.md
│   ├── palindrome-creation-lessons.md
│   └── old-docs/      # アーカイブ
├── src/               # ソースコード
│   └── check_palindrome.py
├── data/              # 作成した回文データ
│   └── palindromes/
│       ├── by-theme/
│       ├── by-length/
│       └── by-date/
├── tests/             # テストケース
└── outputs/           # 生成結果
    ├── try01/         # 各試行
    ├── try02/
    └── generation-log-*.md
```

### 作業場所
**すべての回文作成作業は `/palindromes-maker/` ディレクトリ内で実施する。**

## 回文作成の核心プロセス

### 1. 必須の検証ステップ

**すべての回文候補は必ずスクリプトで検証する。**

```bash
# 単一の候補をチェック
python3 src/check_palindrome.py "候補文字列"

# 複数の候補を一度にチェック
python3 src/check_palindrome.py "候補1" "候補2" "候補3"
```

**重要**: 手動での検証は禁止。必ずツールを使用すること。

### 2. 日本語自然さの評価

**必ずevaluation-prompts.mdを参照して評価を実施する。**

- `docs/evaluation-prompts.md`の評価プロンプトを使用
- 特に「双方向評価プロンプト」と「総合評価プロンプト」を活用
- 評価結果は具体的な数値とコメントで記録

**evaluation-prompts.mdの継続的更新**
- 評価実践で得られた知見を即座に反映
- より精密な評価基準へと改善
- 新しい評価観点の追加

### 日本語成立の厳格な基準

**最低限の基準（必須）**
- 文法的に正しい日本語であること
- 実在する単語・表現のみを使用
- 造語や意味不明な音の羅列は不可
- 両方向とも最低限の意味が通ること

**評価基準の明確化**
- 10点：日常会話で使える自然な表現
- 7-9点：やや古風・詩的だが理解可能
- 4-6点：意味は分かるが不自然
- 1-3点：かろうじて意味が推測できる
- 0点：意味不明・造語・文法破綻

**採用基準**
- 両方向とも最低5点以上
- 平均7点以上を目標
- 片方が10点でも、もう片方が3点以下なら不採用

### 3. 段階的拡張の記録

```yaml
段階1:
  候補: "なつ"
  検証: 回文でない（なつ ≠ つな）
  結果: 却下

段階2:
  候補: "なつつな"
  検証: 回文である（なつつな = なつつな）
  自然さ: 前○、後×（「つな」が不自然）
  結果: 基礎として採用可能だが要改善
```

## 具体的な作業フロー

### 回文作成時の手順

1. **要件確認**
   - テーマ
   - 文字数制約
   - スタイル（厳密/寛容）

2. **語彙収集**
   - テーマ関連語
   - 回文になりやすい語
   - 使用可能な助詞

3. **試行と検証**（ultrathink使用）
   - 候補生成
   - 回文性確認
   - 自然さ評価
   - 結果記録

4. **保存**
   - JSON形式で保存
   - 適切なディレクトリに配置
   - メタデータを含める

## エラーからの学習

### 過去の重要な誤り

1. **回文の誤認識**
   - 例：「ああなつよなつああ」を回文と誤認
   - 学習：必ず文字単位で検証

2. **不自然な日本語**
   - 例：「日も夏暑な、も日」
   - 学習：各段階で自然さを確認

3. **検証の省略**
   - 例：思い込みで判断
   - 学習：システマティックな検証を徹底

## 継続的改善

### 改善サイクル

1. **試行** → 新しいアプローチを試す
2. **記録** → 結果を詳細に記録
3. **分析** → 成功/失敗の要因を分析
4. **改善** → プロセスを更新
5. **文書化** → 知見を文書に反映

### フィードバックの即時反映

- ユーザーの指摘は最優先
- 誤りは即座に認めて修正
- 改善内容は必ず文書化
- 同じ誤りを繰り返さない

## 参照すべきドキュメント

### 必須参照（最新版）
1. **基礎知識**: `docs/palindrome-creation-guide.md`
2. **拡張戦略**: `docs/expansion-strategies.md`
3. **評価方法**: `docs/evaluation-prompts.md`
4. **方法論**: `docs/llm-palindrome-creation-methodology.md`
5. **教訓**: `docs/palindrome-creation-lessons.md`

### ドキュメント管理
- `docs/README.md` で最新の構成を確認
- 古いドキュメントは `docs/old-docs/` に保管
- 常に最新版を参照すること

## コマンド（将来実装予定）

```bash
# 回文の検証
python verify_palindrome.py "候補文字列"

# 自然さの評価
python evaluate_naturalness.py "候補文字列"

# 回文の生成
python generate_palindrome.py --theme "夏" --length 100
```

---

**Remember**: 常に検証、常に改善、常に記録。